<!DOCTYPE html>
<html>
  <head>
    <title>Configurable</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.0/jquery.mobile-1.4.0.min.css" />
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.0/jquery.mobile-1.4.0.min.js"></script >
    <script>
		$( document ).on( "pageinit", "#main", function() {
			$( "#autocomplete" ).on( "filterablebeforefilter", function ( e, data ) {
				var $ul = $( this ),
					$input = $( data.input ),
					value = $input.val(),
					html = "";
					console.log("Text:"+data.input.val());
				$ul.html( "" );
				if ( value && value.length > 2 ) {
					$ul.html( "<li><div class='ui-loader'><span class='ui-icon ui-icon-loading'></span></div></li>" );
					$ul.listview( "refresh" );
					$.ajax({
						url: "http://gd.geobytes.com/AutoCompleteCity",
						dataType: "jsonp",
						crossDomain: true,
						data: {
							q: $input.val()
						}
					})
					.then( function ( response ) {
						$.each( response, function ( i, val ) {
							html += "<li><a href=#>" + val + "</a></li>";
						});
						$ul.html( html );
						$ul.listview( "refresh" );
						$ul.trigger( "updatelayout");
					});
				}
			});
		});
$().ready(function() {
	 $("#test").click(function() {
          	console.log("Click on button");
		$( "#autocomplete" ).placeholder = "nana";
		var ul = $( "#autocomplete" );
		console.log("Click on button end "+JSON.stringify(ul.target));
           });
        });
    </script> 
<style>
.ui-filter-inset {
    margin-top: 0;
}
</style>


  </head>
  <body>
    <div data-role="page" id="main">
      <div data-role="header" class="jqm-header">
        <h1>Configurable Pebble App</h1>
      </div>

      <div data-role="content">
<form>
  <input id="pre-rendered-filterable" data-type="search">
</form>

<div
  class="ui-controlgroup ui-controlgroup-vertical ui-corner-all"
  data-role="controlgroup"
  data-filter="true"
  data-input="#pre-rendered-filterable"
  data-filter-reveal="true"
  data-enhanced="true">
  <div class="ui-controlgroup-controls">
    <a href="index.html" class="ui-screen-hidden" data-role="button">General</a>
    <a href="settings.html" class="ui-screen-hidden" data-role="button">Settings</a>
    <a href="advanced.html" class="ui-screen-hidden" data-role="button">Advanced</a>
    <a href="notifications.html" class="ui-screen-hidden" data-role="button">Notifications</a>
  </div>
</div>


<ul id="autocomplete" data-role="listview" data-inset="true" data-filter="true" data-filter-placeholder="Type a city name..." data-filter-theme="a"></ul>

  	<div class="ui-body ui-body-d ui-corner-all">
  	<input id="cty_sel" data-type="search" placeholder="Type a city name 2...">
                	<div data-role="controlgroup" id="cty_results"><!-- items will be injected here --></div>
                </div>

    <div class="ui-input-btn ui-btn ui-corner-all ui-shadow">
        Input value
        <input type="button" data-enhanced="true" value="Input value" id="test">
    </div>

        <div data-role="fieldcontain" class="ui-widget">
          <label for="city_name">Select a City:</label>
          <input type="text" name="city_name" id="city_name" value="" data-mini="true">
          <div id="selected_city"></div>
        </div>
        

            </fieldset>
	</form>
          </div>
        </div>

        <div class="ui-body ui-body-b">
          <fieldset class="ui-grid-a">
              <div class="ui-block-a"><button type="submit" data-theme="d" id="b-cancel">Cancel</button></div>
              <div class="ui-block-b"><button type="submit" data-theme="a" id="b-submit">Submit</button></div>
            </fieldset>
          </div>
        </div>
      </div>
    </div>
    <script>

      function requestURL(urll) {
	console.log("requested url is:"+urll);
	var jsonObj = new Object;
	var http_request = new XMLHttpRequest();
	http_request.open("GET", urll , false);
	http_request.send();
	jsonObj = JSON.parse(http_request.responseText);
	return jsonObj;	
	}
      function saveOptions() {
        var options = {
          'name': $("#name").val(),
          'special-feature': $("#special-feature").val(),
          'checkbox-cheetos': $("#checkbox-cheetos").is(':checked'),
          'checkbox-doritos': $("#checkbox-doritos").is(':checked'),
          'checkbox-fritos': $("#checkbox-fritos").is(':checked'),
          'checkbox-sunchips': $("#checkbox-sunchips").is(':checked')
        }
	var selected_id  = $( "input:radio[name='cty']:checked" ).attr("id");
	console.log("Selected item is "+selected_id);
	var url_lat = "https://maps.googleapis.com/maps/api/geocode/json?address=%20+%20+%20+%20+"+$("input:radio[name='cty']:checked" ).attr("value")+"+%20&sensor=false&key=AIzaSyALTyx9QM5FyrbZlrqvyWYPUPUY18-mLSo";
	console.log("First url:"+url_lat);
       
	var result1 = requestURL(url_lat);
	console.log("City info jsonObject is:"+JSON.stringify(result1));
	var latittude = result1.results[0].geometry.location;
	console.log("Latittude:"+latittude);
	url_lat = "https://maps.googleapis.com/maps/api/timezone/json?location="+latittude.lat+","+latittude.lng+"&timestamp="+new Date().getTime()/1000+"&sensor=false&key=AIzaSyALTyx9QM5FyrbZlrqvyWYPUPUY18-mLSo";
	console.log("Second url:"+url_lat);
	result1 = requestURL(url_lat);
	console.log("Zone info jsonObject is:"+JSON.stringify(result1));
        return options;
      }

      $().ready(function() {
        $("#b-cancel").click(function() {
          console.log("Cancel");
          document.location = "pebblejs://close";
        });

        $("#b-submit").click(function() {
          console.log("Submit");

          var location = "pebblejs://close#" + encodeURIComponent(JSON.stringify(saveOptions()));
          console.log("Warping to: " + location);
          console.log(location);
         // document.location = location;
        });

      });
    </script>
  </body>
</html>
